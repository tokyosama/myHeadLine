{"version":3,"file":"js/Search.762251dc.js","mappings":"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","sources":["webpack://head-line/./src/views/Search/index.vue","webpack://head-line/src/views/Search/index.vue","webpack://head-line/./src/views/Search/index.vue?527b","webpack://head-line/./src/views/Search/index.vue?fbd9","webpack://head-line/./src/api/Search.js"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('div',{staticClass:\"search-header\"},[_c('van-icon',{staticClass:\"goback\",attrs:{\"name\":\"arrow-left\",\"color\":\"white\",\"size\":\"0.48rem\"},on:{\"click\":function($event){return _vm.$router.back()}}}),_c('van-search',{directives:[{name:\"fofo\",rawName:\"v-fofo\"}],attrs:{\"placeholder\":\"请输入搜索关键单字\",\"background\":\"#007BFF\",\"shape\":\"round\"},on:{\"input\":_vm.inputFn,\"search\":_vm.searchFn},model:{value:(_vm.kw),callback:function ($$v) {_vm.kw=(typeof $$v === 'string'? $$v.trim(): $$v)},expression:\"kw\"}})],1),(this.kw.length !== 0)?_c('div',{staticClass:\"sugg-list\"},_vm._l((_vm.suggestList),function(str,index){return _c('div',{key:index,staticClass:\"sugg-item\",domProps:{\"innerHTML\":_vm._s(_vm.light(str, _vm.kw))},on:{\"click\":function($event){return _vm.suggestClickFn(str)}}})}),0):_c('div',{staticClass:\"search-history\"},[_c('van-cell',{attrs:{\"title\":\"搜索历史\"},scopedSlots:_vm._u([{key:\"right-icon\",fn:function(){return [_c('van-icon',{staticClass:\"search-icon\",attrs:{\"name\":\"delete\"},on:{\"click\":_vm.clearFn}})]},proxy:true}])}),_c('div',{staticClass:\"history-list\"},_vm._l((_vm.history),function(str,index){return _c('span',{key:index,staticClass:\"history-item\",on:{\"click\":function($event){return _vm.historyClickFn(str)}}},[_vm._v(_vm._s(str))])}),0)],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <!-- 搜索页面头部 -->\n    <div class=\"search-header\">\n      <!-- 后退按钮 -->\n      <van-icon\n        name=\"arrow-left\"\n        color=\"white\"\n        size=\"0.48rem\"\n        class=\"goback\"\n        @click=\"$router.back()\"\n      />\n      <!-- 搜索组件 input事件在输入框变化时触发事件,@search确定搜索时触发,手机上键盘右下角的 -->\n      <van-search\n        placeholder=\"请输入搜索关键单字\"\n        v-model.trim=\"kw\"\n        @input=\"inputFn\"\n        background=\"#007BFF\"\n        shape=\"round\"\n        v-fofo\n        @search=\"searchFn\"\n      />\n    </div>\n\n    <!-- 搜索建议栏不能和搜索历史同时出现 -->\n    <div class=\"sugg-list\" v-if=\"this.kw.length !== 0\">\n      <!--插值表达式只会把light(str,kw)返回的内容转成字符串 v-html将返回内容转成html -->\n      <div\n        class=\"sugg-item\"\n        v-for=\"(str, index) in suggestList\"\n        :key=\"index\"\n        v-html=\"light(str, kw)\"\n        @click=\"suggestClickFn(str)\"\n      ></div>\n    </div>\n\n    <!-- 搜索历史 -->\n    <div class=\"search-history\" v-else>\n      <!-- 标题 -->\n      <van-cell title=\"搜索历史\">\n        <!-- 使用 right-icon 插槽来自定义右侧图标 -->\n        <template #right-icon>\n          <van-icon name=\"delete\" class=\"search-icon\" @click=\"clearFn\" />\n        </template>\n      </van-cell>\n\n      <!-- 历史列表 -->\n      <div class=\"history-list\">\n        <span\n          class=\"history-item\"\n          v-for=\"(str, index) in history\"\n          :key=\"index\"\n          @click=\"historyClickFn(str)\"\n          >{{ str }}</span\n        >\n      </div>\n    </div>\n  </div>\n</template>\n  \n<script>\n// 目标：1.跳转到搜索结果界面\n// 1.输入框回车->跳转到输入框文字搜索的结果页\n// 2.点击联想列表的某一个文章->搜索结果页\n// 3.点击历史记录的标签->搜索结果页\nimport { suggestListAPI } from '@/api/Search.js'\nimport { setStorage, getStorage } from '@/utils/storage'\n\nexport default {\n  name: 'mySearch',\n  data() {\n    return {\n      // 搜索关键字\n      kw: '',\n      // 防抖定时器\n      timer: null,\n      // 联想建议列表\n      suggestList: [],\n      // 历史搜索列表\n      history: JSON.parse(getStorage('his')) || []\n    }\n  },\n  methods: {\n    // 输入框实时变化\n    inputFn() {\n      // 输入框变化了清除计时器\n      clearTimeout(this.timer)\n      // 如果搜索栏没有字就清空联想列表\n      if (this.kw.length === 0) {\n        this.suggestList = []\n      } else {\n        // 防抖 1.延时事件\n        this.timer = setTimeout(async () => {\n          if (this.kw.length === 0) return\n          // 获取搜索建议\n          // console.log('即将获取')\n          const { data: res } = await suggestListAPI({ keywords: this.kw })\n          this.suggestList = res.data.options\n        }, 400)\n      }\n    },\n    // 处理字符串高亮\n    light(originStr, target) {\n      // orrginStr:字符串,target:关键字\n      // replace只替换第一个匹配的字，rereplaceAll都替换\n      // 如果使用变量当正则匹配条件，不能用简化语法糖，必须用js new RegExp\n      // (target, 'ig')代表把全部的target都匹配,ihulve大小写，g全局匹配\n      const reg = new RegExp(target, 'ig')\n      // q:'j' a:'Java','ja','java'\n      // 替换后的值不能用target,因为联想列表的关键字有大小写，不能改成关键字的小写方式\n      // return originStr.replace(reg, `<span style=\"color: red;\">${target}</span>`)\n      // 解决:replace可以有回调函数replace(正则/字符串, 带return回调函数)\n      // https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/replace\n      if (originStr !== null) {\n        const newStr = originStr.replaceAll(reg, (match) => {\n          // match是原来字符串里的字符，用原来的，然后换颜色\n          return `<span style=\"color: red;\">${match}</span>`\n        })\n        return newStr\n      }\n    },\n\n    // 跳转函数\n    moveFn(url) {\n      // 执行整个函数时这里要加settimeout否则会直接跳转路由当前组件被销毁了,导致history数组没有保存,watch侦听器是\n      // 异步执行由于路由跳走了没来得及起作用\n      // 包个定时器变成宏任务，宏任务最后执行\n      setTimeout(() => {\n        this.$router.push(`/search_result/${url}`)\n      }, 0)\n    },\n\n    // 点击回车搜索\n    searchFn() {\n      // 将关键字保存到数组里\n      // 输入框得有字才能push到数组和跳转\n      if (this.kw.length > 0) {\n        this.history.push(this.kw)\n        this.moveFn(this.kw)\n      }\n    },\n    // 点击联想菜单标签搜索\n    suggestClickFn(str) {\n      // 将关键字保存到数组里\n      this.history.push(str)\n      this.moveFn(str)\n    },\n    // 点击历史记录搜索\n    historyClickFn(str) {\n      // 就不需要将关键字保存到数组里\n      this.moveFn(str)\n    },\n    // 清除历史搜索\n    clearFn() {\n      this.history = []\n    }\n  },\n  watch: {\n    // 监听this.history\n    history: {\n      deep: true,\n      // 必须是handler\n      handler() {\n        // 立刻覆盖式保存本地,只能存字符串,所以把history数组转为json\n        // ES6新增两种引用类型(以前是 Array,Object),(新增：Set Map)\n        // Set:无序不重复的value集合体(无下角标)\n        // 特点:你传入的数组类型，如果有重复元素,会自动清理掉重复元素，返回无重复的Set对象\n        //      如果比较的值是对象则比较的是对象的内存地址\n        const theSet = new Set(this.history)\n        // Array.from将Set类型转为Array数组类型\n        const arr = Array.from(theSet)\n        setStorage('his', JSON.stringify(arr))\n      }\n    }\n  }\n}\n</script>\n  \n  <style scoped lang=\"less\">\n.search-header {\n  height: 46px;\n  display: flex;\n  align-items: center;\n  background-color: #007bff;\n  overflow: hidden;\n\n  /*后退按钮*/\n  .goback {\n    padding-left: 14px;\n  }\n\n  /*搜索组件*/\n  .van-search {\n    flex: 1;\n  }\n}\n\n/*搜索建议列表样式 */\n.sugg-list {\n  .sugg-item {\n    padding: 0 15px;\n    border-bottom: 1px solid #f8f8f8;\n    font-size: 14px;\n    line-height: 50px;\n    // 实现省略号的三行代码\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n}\n\n/**搜索历史 */\n.search-icon {\n  font-size: 16px;\n  line-height: inherit;\n}\n\n.history-list {\n  padding: 0 10px;\n\n  .history-item {\n    display: inline-block;\n    font-size: 12px;\n    padding: 8px 14px;\n    background-color: #efefef;\n    margin: 10px 8px 0px 8px;\n    border-radius: 10px;\n  }\n}\n</style>","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=75a1cb08&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=75a1cb08&prod&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"75a1cb08\",\n  null\n  \n)\n\nexport default component.exports","// 统一封装接口\nimport axios from '@/utils/request.js'\n//  需要header的请求在请求拦截器里已经统一装好了\n\n// 搜索-联想菜单\nexport const suggestListAPI = ({ keywords }) => {\n    return axios({\n        url: '/v1_0/suggestion',\n        method: 'GET',\n        params: {\n            q: keywords\n        },\n    })\n}\n\n// 搜索-搜索结果列表\nexport const searchResultAPI = ({ page = 1, perPage = 10, q }) => {\n    return axios({\n        url: '/v1_0/search',\n        method: 'GET',\n        //  接口文档说前两个参数可不传，默认只获取1页10条数据就行\n        params: {\n            page,\n            per_page: perPage,\n            q\n        },\n    })\n}"],"names":["render","_vm","this","_c","_self","staticClass","attrs","on","$event","$router","back","directives","name","rawName","inputFn","searchFn","model","value","kw","callback","$$v","trim","expression","length","_l","suggestList","str","index","key","domProps","_s","light","suggestClickFn","scopedSlots","_u","fn","clearFn","proxy","history","historyClickFn","_v","staticRenderFns","data","timer","methods","clearTimeout","keywords","moveFn","setTimeout","watch","deep","handler","setStorage","component","suggestListAPI","axios","url","method","params","q","searchResultAPI","page","perPage","per_page"],"sourceRoot":""}